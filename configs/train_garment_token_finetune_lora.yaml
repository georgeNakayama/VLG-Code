# Training configuration for Pattern Shape prediction model 
# (part I of NeuralTailor)

# 0.5 * stitch cls loss (focal loss) + 0.005 * stitch ce loss + 5 * panel loss
defaults: 
  - data_wrapper: finetune_garment_token_data_wrapper
  - model: gpt2
  - trainer: text_trainer
  - system: my_system
  - experiment: gpt2_experiment
  - _self_

data_wrapper: 
  stop_token: 50256
  panel_start: 50513
  panel_end: 50514
  bin_size: 256

model:
  _target_: models.decoders.lora_gpt2.GPT
  ignore_index: null  # ignore padding token
  block_size: 1024
  new_vocab_size: ${eval:'${..data_wrapper.bin_size} + 2'} # 256 bin + 2 panel tokens
  lora_attn_dim: 4
  lora_attn_alpha: 32
  lora_attn_dropout: 0.1
  lora_embd_dim: 4

experiment:
  run_name: finetune_garment_token_lora

trainer:
  _target_: trainers.finetune_garment_token_trainer.FinetuneGarmentTokenTrainer
  total_batch_size: 131072

test_only: False
random_seed: 42
pre_trained: null
storage_dir: null
from_pretrained: gpt2